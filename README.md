# TallerJava
Proyecto, Taller Java 2025
Dylan Rodriguez, Diego Pozzi, Matias Rodriguez, Federico Olivera
Implementacion de Pasarela de Pagos
# Diseño
- Diagrama de Clases
  
   - Modulo Comercio
     
    ![image](https://github.com/user-attachments/assets/5a3a3874-a071-4a79-a859-4455eff89e06)


   - Modulo Compras
   
    ![image](https://github.com/user-attachments/assets/a79c6b3b-1c45-4af1-9dcf-00f11dbba15c)



   - Modulo Transferencias
   
     ![image](https://github.com/user-attachments/assets/f8363053-761c-4963-896e-a8e8c456cb4d)


   - Modulo Monitoreo
   
   *No cuenta con clases*


  ---
- Diagrama de Casos de Uso - Diagramas de Secuencia
  - Alta comercios
    
    ![VP5BQWCn38RtEeNmAeNa0bcKX915AJJ3x4heGXsB8F2C1iiJ4aeFqxFqOhKDKnfAwvt4zp-4DvOefgaFa2G5HhSZK_ICa-aQAIJQQS-n4rruIchpTES0g4iQSUjx6M3CBjB9I4D2jsqUi26Zo84QEgav9CEylSLchvP7DSbUrygL4Q3Qukg-oF3V9gM7d2bnJIXuLXMJB3jD53t5HVSR](https://github.com/user-attachments/assets/0c396dd2-4d85-4524-8cb8-4824ab5a5455)


  - alta pos
    
    ![TP4nQWCn44NxESMmbGth2xW8Di65IR5YKmMJObWDPa2xMZHQ9o7aC3bBBfQHYc2JH9Kq_FV_bxJJJ2alOu0iEJ0szwGHFUEYSOiKChcego6Ed0Q9BSvHrmq03JactFjH9fZDG0QPQShOxDqH7Iab3kJe7BL1KhJfhSnrZpsRbvZDMvMK8q1rnCrT8V1t_j6tw2b7DNvTIiY5CbVx0XXN](https://github.com/user-attachments/assets/4e3af4ab-c5b7-4144-bac3-6dece8592bbb)



  - cambiar estado pos
    
    ![VPB1QiCm38RlVWejfmpI5oXqD9GUIc49sN7ieDdUC3XMi9t2DlRkaztI9LcPRv7rV_fGl0qHVHnxAwA9LaEnmq2WD8o1rY2nVpNezzoagALGIkgrbuOg62WSL0Lkr2SwtzyNGg2CvA5MlN5YOB2HPa0NeQZR0xGOq6kBBRvJA003S7NUrZPFdMQqOSn7RacVGcGYh1vI0lxnIaetp9AN](https://github.com/user-attachments/assets/fe49c917-204c-4d75-8d6c-4bd4a0bd86be)


  - cambio contraseña
    
    ![VLBDIiGm4BxdAOQULkY-m1vafUv11BVqkdWOar42QQOawOgA3-Kp-69EYgtjKimfcNn_Cya-9WofRvrADZc2eiB8O0Zwo3lGs3vPhjYdW96-lt3ZUpfZZJ5U5KgXJXoWufQ2jgmwKRBQTkWJ58B1G0vlgSONZWLWXBfUOaPcGnr7Arfl0omVbHelONijHFW_J8vYpvWeUmXQE5b5MC_M](https://github.com/user-attachments/assets/69ee1c03-8f62-4f33-a5a4-f846fbc6e979)


  - realizar reclamo
    
    ![realizar reclamo](https://github.com/user-attachments/assets/89369427-d379-4f0b-bd81-ba17adfa21df)
  
  - resumen ventas diarias
  
    ![XOyn2iCm34Ltdq9aQeTS84C990Sm7Rf_R544YHKifUUl0stfKEYept_lez4SrVTr2Iw-C4qmfSoqcmvKsVQLousBmsP15TWfwSerYPv3G7AjDBs2i3MJ9DbGdBe8G-K5CqVSrJg2KOmXlDlKNzfDVqVQXZpWVC2jtpVienWemzMkFmmXypSvSidjoIS0](https://github.com/user-attachments/assets/b33f1c1f-c65d-479e-b951-1f0f188e5e02)

  - resumen ventas por periodo
  
    ![bO-z2iCm38HtFON8r4Bp0XbA87q0qw6xi4Kns5QGb3v_NVf3XouTJxhxZflDINsh1JnxOLp811FZPZAXicsLsuMRamNHm9eboIvAPOrP3hW-Bti0YYwAo-i3QwVcc5TgZaCW8-L29mvq5HkG34C0UBjnF7QDVnNsldmZvmUePyUE-E0cJEHYvzyqIFmTdhcbllyE](https://github.com/user-attachments/assets/e0d8c8bd-19be-4493-90d6-8f886ddcd993)

  - monto actual vendido
  
    ![XO-n2iCm34HtVON8r0xvWGmb9LqBdheBMnI3RGLBoVTNXROKEdIyuzuTDwjHjwqMi6o5SI4LJ8oRoeHLciavsaRbnYtb98SebNlCSWIWQD9nUHcmUa-EUQLcE0HIwbpeme7keWEIOWW0xpIE9zVuPy8Nyax6JzJJeqEVWWbtAjAlFpma_kPcT_tU0m00](https://github.com/user-attachments/assets/03559a2c-cfa3-43c1-9cc4-4bbc6f9bba41)


  - recibir Notificacion Transferencia Desde Medio de Pago (datosTransferencia)
  
    ![XL9TJiCm37xFAQmzRHBZ04YWgPruwvG7Bc0ITrYaSPMaN8mZS36SmhI2YdYphE_FNtB81LEPXc0Abq3GOXRm15EMEqZa-9dJIGhtxD2nnAU4CVUKA3h68sLF7NaMYsVPUYoIVm1sng0hac0pewfmHMu0CtJMZ6hDZaUC1JOMCoOAM05vHjXVY0QZgne1MXaeQPmPrhJ6T1Rs3qg0_qEl](https://github.com/user-attachments/assets/eda1561b-69f8-4b02-a90d-f0351ce244ad)


  - consultarDepositos (comercios, rangoFechas)
  
    ![ZP71gW8n34Nt_OhWIk7v0ov4doAuA_v1QAC6QZCq7S6_DnsS0Ls8gr9wxybfkz6AfVQtv2hNHB135OW4lSeAWcJjamNsr8bo5Pq7kL49B7zGC5_aGE6Akd0EGvK2kzUfwmpAWJlC5MOU5Gibz7WHdG4gUF-U6FcdrreUGwnjdHkXi5nR4Rvg7UE7c7dn7IkraLOsH8CQvCmvJlt_npXa](https://github.com/user-attachments/assets/e977a37f-f8f2-4584-a17d-28538dc1c81f)

---

- Diagramas de Paquetes
  
  ![{0C86C21A-F54F-4AB2-8D5B-63859FF3DFC3}](https://github.com/user-attachments/assets/c87e9676-b949-42dd-a860-beb536cef572)

---

- Diagrama de modulo Pasarela de Pagos
  
  ![Diagrama_sin_titulo drawio1](https://github.com/user-attachments/assets/8bdbd892-1a53-4bf0-981f-c15cb9b36dc2)


# Arquitectura

![Captura de pantalla 2025-07-03 025433](https://github.com/user-attachments/assets/7f2cff00-9f69-490c-a6d7-c964830db0b3)


- Comercio: Es la entidad que se comunica con la pasarela de pagos
  - POS: En este caso serían las llamadas al API.
  - BROWSER: Sería como accedería el cliente al Gestor Web para registrarse, consultar estadísticas, realizar reclamos etc.


- Server Pasarela

  - GESTOR WEB: Sería la página web del cliente.
  - Pasarela de Pagos: El corazón del sistema, expone las funcionalidades de la pasarela.
  - Medio de pago: Simula ficticiamente al medio de pago, en una implementacion real sería externa
  - Banco cliente: Simula la entidad bancaria del cliente, pasa lo mismo que con Medio de Pago
  - ArtemisMQ: Es el servicio de messaging implementado en wildfly, encola los reclamos para que sean procesador por ReclamosAIClient, esto es gestionado asíncronamente por MDB para que no se interrumpa la ejecución por culpa del motor AI.
  - ReclamosAIClient: El modelo de inteligencia artificial que procesa los reclamos y les asigna un grado de importancia, se procesa paralelamente.
  - DATABASE: Base de datos de la pasarela.

- Docker Container: Corre en realidad en el mismo servidor, pero asilado en un contenedor.
  - Grafana: Crea las dashboards de monitoreo con las querys de influxDB
  - InfluxDB: Genera los datos a ser graficados y los envia a Grafana
  - Telegraf: Genera las métricas del sistema y las envia a InfluxDB, como esta en un componente aislado no refleja las métricas del servidor de pasarela en su totalidad.


# Funcionalidades
- Rate Limiter
  - El Rate Limiter funciona para limitar la cantidad de registros de pagos en el sistema para que no se sobrecargue, el rate limiter implementado es de tipo Leaky token que funciona de la siguiente manera:
    
    - Partimos de un balde vacío pero con un límite de tokens.

    - Cada vez que llega un request, ponemos un token en el balde. (cola de mensajes)

    - El request no se procesa inmediatamente sino que lo hace a ritmos preestablecidos (como una gota que cae de un balde)

    - Cuando el balde se llena los request, se rechazan.

    - Los request que entran al balde, se ejecutan de forma secuencial.
   
      
  - Aqui se ve como trabaja el rate limiter con esta prueba JMeter, se cancelan una porción de las consultas enviadas a fuerza bruta.   
    ![Captura de pantalla 2025-07-03 030904](https://github.com/user-attachments/assets/ef7d5b5a-eefb-4c75-9a7a-2f8fd665018e)


- Observabilidad
  - Esta gráfica muestra cada llamada a los endpoint de Comercio y muestra la latencia de las mismas expresada en milisegundos.
    ![Captura de pantalla 2025-07-03 031614](https://github.com/user-attachments/assets/96c27f12-a512-4875-88cb-c6260b8764a6)

  - Lo mismo que con Comercio.
    ![Captura de pantalla 2025-07-03 031626](https://github.com/user-attachments/assets/9d65bcb3-f1b4-45d1-9cdd-aca10fb6fc5a)

  - Lo mismo que con Comercio.
    ![Captura de pantalla 2025-07-03 031641](https://github.com/user-attachments/assets/7cc6ef31-4644-45ed-b1a6-c2d218e1bc5e)

  - Son las gráficas de uso de recursos del Servidor, como están dentro del contenedor Docker solo refleja el consumo de este, estás están proveídas por Telegraf.
    ![Captura de pantalla 2025-07-03 031651](https://github.com/user-attachments/assets/4dbaa30e-ac2d-4330-b1ca-5daaf070a3e9)
  
# Endpoints


| Operación             | Método | Consumes           | Parámetros / Body                                                        | Respuesta                                                     |
| --------------------- | :----: | ------------------ | ------------------------------------------------------------------------ | ------------------------------------------------------------- |
| Registrar comercio    |  POST  | `application/json` | `{ "nombre","correo","telefono","contrasenia" }`                         | `200 OK`<br>`"Registro satisfactorio."`                       |
| Agregar POS           |  POST  | Form params        | `correo=p&contr=...`                                                     | `200 OK`<br>`"POS agregado satisfactoriamente."`              |
| Realizar reclamo      |  POST  | `application/json` | `AuthRequest + { "texto": "..." }`                                       | `200 OK`<br>`"Reclamo realizado satisfactoriamente."`         |
| Modificar comercio    |  POST  | `application/json` | `AuthRequest + { "nombre","telefono","nuevoCorreo","nuevaContrasenia" }` | `200 OK`<br>`"Datos modificados satisfactoriamente."`         |
| Cambiar estado de POS |  POST  | `application/json` | `AuthRequest + { "idPOS", "estado" }`                                    | `200 OK`<br>`"Estado del POS modificado satisfactoriamente."` |

| Operación            | Método | Consumes           | Parámetros / Body                                                                     | Respuesta                                     |
| -------------------- | :----: | ------------------ | ------------------------------------------------------------------------------------- | --------------------------------------------- |
| Pago simple          |  POST  | Query-string       | `?idComercio=&idPos=&monto=&numero=&cvv=&propietario=&vencimiento=`                   | `200 OK`<br>`Compra` JSON                     |
| Pago (JSON)          |  POST  | `application/json` | `{ "idComercio","idPos","monto","dataTarjeta":{numero,cvv,vencimiento,propietario} }` | `201 Created`<br>`Compra` JSON                |
| Ventas diarias       |   GET  | `application/json` | `?idComercio=`                                                                        | `200 OK`<br>`[Compra,…]`                      |
| Ventas por periodo   |   GET  | `application/json` | `?idComercio=&desde=YYYY-MM-DD&hasta=YYYY-MM-DD`                                      | `200 OK`<br>`[Compra,…]`                      |
| Monto actual vendido |   GET  | `application/json` | `?idComercio=`                                                                        | `200 OK`<br>`{ "montoActualVendido": float }` |

| Operación          | Método | Produces           | Parámetros                                       | Respuesta                       |
| ------------------ | :----: | ------------------ | ------------------------------------------------ | ------------------------------- |
| Ventas por periodo |   GET  | `application/json` | `?idComercio=&desde=YYYY-MM-DD&hasta=YYYY-MM-DD` | `200 OK`<br>`[Transferencia,…]` |






VENTAS DIARIAS:


curl.exe -X GET "http://localhost:8080/TallerJavaEE-1.0-SNAPSHOT/api/compra/ventasDiarias?idComercio=1"


VENTAS POR PERIODO:

curl.exe "http://localhost:8080/TallerJavaEE-1.0-SNAPSHOT/api/compra/ventasPeriodo?idComercio=1&desde=2025-05-01&hasta=2025-05-23"


MONTO ACTUAL VENDIDO:

curl.exe -X GET "http://localhost:8080/TallerJavaEE-1.0-SNAPSHOT/api/compra/montoActualVendido?idComercio=1"



PROCESAR PAGO:

curl.exe --% -X POST "http://localhost:8080/TallerJavaEE-1.0-SNAPSHOT/api/compra/pago-simple?idComercio=1&idPos=1&monto=5400&numero=1232&cvv=143&propietario=Machi&vencimiento=2025-05-30T18:43:45.000Z"



